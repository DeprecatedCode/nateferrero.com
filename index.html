<!doctype html>
<head>
    <title>Nate Ferrero</title>
    <link href='http://fonts.googleapis.com/css?family=Asap:400,700,400italic,700italic' rel='stylesheet' type='text/css' />
    <link href="/style/default.css" type="text/css" rel="stylesheet" />
    <script src="/scripts/showdown.js" type="text/javascript"></script>
    <script src="/scripts/jquery.js" type="text/javascript"></script>
    <script src="/scripts/jquery.history.js" type="text/javascript"></script>
    <script src="/scripts/router.js" type="text/javascript"></script>
    <script>
        var router = new Router();
        var md = new Markdown.Converter();

        var post = function(name) {
            $.ajax({
                type: 'GET',
                dataType: 'text',
                url: '/posts/' + name + '.md',
                success: function(data) {
                    data = data.split('\n');
                    var text = '', config = {};
                    for(var i = 0; i < data.length; i++) {
                        var c = data[i];
                        if(c.charAt(0) === '@') {
                            var d = c.substr(1).split(' ');
                            var e = d.shift();
                            config[e] = d.join(' ');
                        } else {
                            text += c + '\n';
                        }
                    }
                    console.log(config);
                    $('.content').html(md.makeHtml(text));
                },
                error: function() {
                    $('.content').html('<h1>Page Not Found</h1>'+
                        '<p>You may want to go to the <a href="/">home page</a>.</p>');
                }
            });
        };
        router.route('/posts/:name', post);
        router.route('/posts/:name/', post);
        
        /**
         * Load Post List
         */
        var postIndex = [];
        $(function() {
            $.ajax({
                type: 'GET',
                dataType: 'text',
                url: '/posts/index.md',
                success: function(data) {
                    data = data.split('\n');
                    var config = {};
                    for(var i = 0; i < data.length; i++) {
                        var c = data[i];
                        if(c.charAt(0) === '@') {
                            var d = c.substr(1).split(' ');
                            var e = d.shift();
                            config[e] = d.join(' ');
                        } else if(c.indexOf(' ') > 0) {
                            var f = c.split(' ');
                            config.url = f.shift();
                            config.title = f.join(' ');
                            postIndex.push(config);
                            config = {};
                        } else {
                            config = {};
                        }
                    }
                }
            });
        });
    </script>
</head>
<body>
    <div class="content">
        <h1>Nate Ferrero</h1>
        <p>Sample text</p>
    </div>
</body>